

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Term and goal expansion &mdash; The Logtalk Handbook v3.22.0-b01 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <!-- begin favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#355b95">
    <meta name="theme-color" content="#ffffff">
    <!-- end favicon -->
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Documenting" href="documenting.html" />
    <link rel="prev" title="Printing messages and asking questions" href="printing.html" />
   

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Logtalk Handbook
          

          
          </a>

          
            
            
              <div class="version">
                3.22.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="declarative.html">Declarative object-oriented programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html">Main features</a></li>
<li class="toctree-l2"><a class="reference internal" href="nomenclature.html">Nomenclature</a></li>
<li class="toctree-l2"><a class="reference internal" href="messages.html">Messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="objects.html">Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="protocols.html">Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="categories.html">Categories</a></li>
<li class="toctree-l2"><a class="reference internal" href="predicates.html">Predicates</a></li>
<li class="toctree-l2"><a class="reference internal" href="inheritance.html">Inheritance</a></li>
<li class="toctree-l2"><a class="reference internal" href="events.html">Event-driven programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="threads.html">Multi-threading programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="errors.html">Error handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="programming.html">Writing and running applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="printing.html">Printing messages and asking questions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Term and goal expansion</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hook-objects">Hook objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="#expanding-terms">Expanding terms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#expanding-goals">Expanding goals</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bypassing-term-and-goal-expansion">Bypassing term and goal expansion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="documenting.html">Documenting</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance.html">Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="installing.html">Installing Logtalk</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration.html">Prolog integration and migration guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../refman/index.html">Reference Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Logtalk Handbook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">User Manual</a> &raquo;</li>
        
      <li>Term and goal expansion</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/LogtalkDotOrg/logtalk3/blob/master/manuals/sources/userman/expansion.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="term-and-goal-expansion">
<span id="expansion-expansion"></span><h1>Term and goal expansion<a class="headerlink" href="#term-and-goal-expansion" title="Permalink to this headline">¶</a></h1>
<p>Logtalk supports the <em>term and goal expansion mechanism</em> also found in some
Prolog systems. This macro mechanism is used to define source-to-source
transformations. Two common uses are the definition of language extensions
and domain-specific languages.</p>
<p>Term and goal expansions are defined using, respectively, the predicates
<a class="reference internal" href="../refman/methods/term_expansion_2.html#methods-term-expansion-2"><span class="std std-ref">term_expansion/2</span></a> and <a class="reference internal" href="../refman/methods/goal_expansion_2.html#methods-goal-expansion-2"><span class="std std-ref">goal_expansion/2</span></a>, which
are declared in the <a class="reference external" href="https://logtalk.org/library/expanding_0.html#expanding-0" title="(in Logtalk APIs v3.22.0)"><span class="xref std std-ref">expanding</span></a> built-in protocol.
These predicates can be called using the <a class="reference internal" href="../refman/methods/expand_term_2.html#methods-expand-term-2"><span class="std std-ref">expand_term/2</span></a> and
<a class="reference internal" href="../refman/methods/expand_goal_2.html#methods-expand-goal-2"><span class="std std-ref">expand_goal/2</span></a> built-in methods or when compiling a source
file.</p>
<div class="section" id="hook-objects">
<h2>Hook objects<a class="headerlink" href="#hook-objects" title="Permalink to this headline">¶</a></h2>
<p>Term and goal expansion of a source file during its compilation is performed
by using <em>hook objects</em>. A hook object is simply an object implementing the
<a class="reference external" href="https://logtalk.org/library/expanding_0.html#expanding-0" title="(in Logtalk APIs v3.22.0)"><span class="xref std std-ref">expanding</span></a> built-in protocol, defining clauses for
the term and goal expansion hook predicates. For example:</p>
<div class="highlight-logtalk notranslate"><div class="highlight"><pre><span></span><span class="p">:- </span><span class="k">object</span>(hook_object,
    <span class="k">implements</span>(expanding)).

    <span class="k">term_expansion</span>(..., ...) <span class="o">:-</span>
        ...

    <span class="k">goal_expansion</span>(..., ...) <span class="o">:-</span>
        ...

<span class="p">:- </span><span class="k">end_object.</span>
</pre></div>
</div>
<p>To compile a source file using a hook object, we can use the
<a class="reference internal" href="programming.html#flag-hook"><span class="std std-ref">hook</span></a> compiler flag in the second argument of the
<a class="reference internal" href="../refman/predicates/logtalk_compile_2.html#predicates-logtalk-compile-2"><span class="std std-ref">logtalk_compile/2</span></a> and <a class="reference internal" href="../refman/predicates/logtalk_load_2.html#predicates-logtalk-load-2"><span class="std std-ref">logtalk_load/2</span></a>
built-in predicates. For example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>| ?- logtalk_load(source_file, [hook(hook_object)]).
...
</pre></div>
</div>
<p>In alternative, you can use a <a class="reference internal" href="../refman/directives/set_logtalk_flag_2.html#directives-set-logtalk-flag-2"><span class="std std-ref">set_logtalk_flag/2</span></a>
directive in the source file itself. For example:</p>
<div class="highlight-logtalk notranslate"><div class="highlight"><pre><span></span><span class="p">:- </span><span class="k">set_logtalk_flag</span>(hook, hook_object).
</pre></div>
</div>
<p>It is also possible to define a default hook object by defining a global
value for the <code class="docutils literal notranslate"><span class="pre">hook</span></code> flag by calling the <a class="reference internal" href="../refman/predicates/set_logtalk_flag_2.html#predicates-set-logtalk-flag-2"><span class="std std-ref">set_logtalk_flag/2</span></a>
predicate. For example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>| ?- set_logtalk_flag(hook, hook_object).

yes
</pre></div>
</div>
<p>When compiling a source file, the compiler will first try the source file
specific hook object, if defined. If that fails, it tries the default hook
object, if defined. If that also fails, the compiler tries the Prolog dialect
specific expansion predicate definitions if defined in the adapter file.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Clauses for the <code class="docutils literal notranslate"><span class="pre">term_expansion/2</span></code> and <code class="docutils literal notranslate"><span class="pre">goal_expansion/2</span></code> predicates
defined within an object or a category are never used in the compilation
of the object or the category itself.</p>
</div>
<p>Sometimes we have multiple hook objects that we need to use in the compilation
of a source file. The Logtalk library includes support for two basic expansion
workflows: a <a class="reference external" href="https://logtalk.org/library/hook_pipeline_1.html#hook-pipeline-1" title="(in Logtalk APIs v3.22.0)"><span class="xref std std-ref">pipeline</span></a> of hook objects, where the
expansion results from a hook object are feed to the next hook object in the
pipeline, and a <a class="reference external" href="https://logtalk.org/library/hook_set_1.html#hook-set-1" title="(in Logtalk APIs v3.22.0)"><span class="xref std std-ref">set</span></a> of hook objects, where expansions
are tried until one of them succeeds. These workflows are implemented as
parametric objects allowing combining them to implement more sophisticated
expansion workflows.</p>
<p>In order to use clauses for the <code class="docutils literal notranslate"><span class="pre">term_expansion/2</span></code> and <code class="docutils literal notranslate"><span class="pre">goal_expansion/2</span></code>
predicates defined in plain Prolog, simply specify the pseudo-object <code class="docutils literal notranslate"><span class="pre">user</span></code>
as the hook object when compiling source files. When using backend Prolog
compilers that support a module system, it can also be specified a module
containing clauses for the expanding predicates as long as the module
name doesn’t coincide with an object name. But note that Prolog module
libraries may provide definitions of the expansion predicates that are
not compatible with the Logtalk compiler. Specially when setting the
hook object to <code class="docutils literal notranslate"><span class="pre">user</span></code>, be aware of any Prolog library that is loaded,
possibly by default or implicitly by the Prolog system, that may be
contributing definitions of the expansion predicates. It is usually
safer to define a specific hook object for combining multiple expansions
in a fully controlled way.</p>
</div>
<div class="section" id="expanding-terms">
<h2>Expanding terms<a class="headerlink" href="#expanding-terms" title="Permalink to this headline">¶</a></h2>
<p>Clauses for the <code class="docutils literal notranslate"><span class="pre">term_expansion/2</span></code> predicate are called until of them
succeeds. The returned expansion can be a single term or a list of terms.</p>
<span class="target" id="index-0"></span><p id="index-1">When using an hook object to expand the terms of a source file, two
virtual terms are generated: <code class="docutils literal notranslate"><span class="pre">begin_of_file</span></code> and <code class="docutils literal notranslate"><span class="pre">end_of_file</span></code>.
These terms allow the user to define term-expansions before and after
the actual source file terms. Logtalk provides a
<a class="reference internal" href="../refman/predicates/logtalk_load_context_2.html#predicates-logtalk-load-context-2"><span class="std std-ref">logtalk_load_context/2</span></a>
built-in predicate that can be used to access the compilation/loading
context when performing term-expansion or goal-expansion.</p>
<p>A common term expansion is the translation of grammar rules into predicate
clauses. This transformation is performed automatically by the compiler
when a source file entity defines grammar rules. It can also be done
explicitly by calling the <code class="docutils literal notranslate"><span class="pre">expand_term/2</span></code> built-in method. For example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>| ?- logtalk::expand_term((a --&gt; b, c), Clause).

Clause = (a(A,B) :- b(A,C), c(C,B))
yes
</pre></div>
</div>
<p>Note that the default translation of grammar rules can be overriden by
defining clauses for the <a class="reference internal" href="../refman/methods/term_expansion_2.html#methods-term-expansion-2"><span class="std std-ref">term_expansion/2</span></a> predicate.</p>
</div>
<div class="section" id="expanding-goals">
<h2>Expanding goals<a class="headerlink" href="#expanding-goals" title="Permalink to this headline">¶</a></h2>
<p>Clauses for the <code class="docutils literal notranslate"><span class="pre">goal_expansion/2</span></code> predicate are recursively called on
the expanded goal until a fixed point is reached. Care must be taken to
avoid compilation loops.</p>
</div>
<div class="section" id="bypassing-term-and-goal-expansion">
<h2>Bypassing term and goal expansion<a class="headerlink" href="#bypassing-term-and-goal-expansion" title="Permalink to this headline">¶</a></h2>
<p>Source file terms and source file goals wrapped by the
<a class="reference internal" href="../refman/control/external_call_1.html#control-external-call-1"><span class="std std-ref">{}/1</span></a> control construct are not expanded.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="documenting.html" class="btn btn-neutral float-right" title="Documenting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="printing.html" class="btn btn-neutral" title="Printing messages and asking questions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Paulo Moura

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>